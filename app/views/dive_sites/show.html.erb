<% dive_site_country = ISO3166::Country.new(@dive_site.country) %>

<div class="top-bar">
<h1><%= @dive_site.name %></h1>
</div>

<div class="show-card-section" data-controller="toggle-favorite">
  <div class="container py-5">
    <div class="row justify-content-between pb-3">
      <div class="col">
        <p><i class="fa-solid fa-star star-color"></i> 5.0 ・ <%= pluralize @dive_site.reviews.count, "review" %> ・ <%= @dive_site.city %>, <%= dive_site_country %>
      </div>
      <div class="col text-end">
        <i class="fa-solid fa-arrow-up-from-bracket"></i> Share ・ <i class="fa-solid fa-anchor"></i> Log ・
        <i data-dive-site-id="<%=@dive_site.id%>" data-toggle-favorite-target="item" data-action="click->toggle-favorite#update" class= "<%= current_user.favorited?(@dive_site) ? 'fa-solid ' : 'fa-regular' %> fa-heart"></i> Save
      </div>
<%# <i class="fa-solid fa-anchor"></i> %>
    </div>

    <%# ***Faire la logique couleur des coeurs avec un IF %>


    <div class="row justify-content-between g-5">
      <div class="col-6">
        <% if @dive_site.photo.attached? %>
          <%= cl_image_tag @dive_site.photo.key, height: 400 %>
        <% else %>
          <img src="<%= @dive_site.image %>" height="400">
        <% end %>
        <div class="row g-5 pt-5 justify-content-evenly">
          <div class="col">
            <% if @dive_site.photo.attached? %>
              <%= cl_image_tag @dive_site.photo.key, height: 100 %>
            <% else %>
              <img src="<%= @dive_site.image %>" height="100">
            <% end %>
          </div>
          <div class="col">
            <% if @dive_site.photo.attached? %>
              <%= cl_image_tag @dive_site.photo.key, height: 100 %>
            <% else %>
              <img src="<%= @dive_site.image %>" height="100">
            <% end %>
          </div>
          <div class="col">
            <% if @dive_site.photo.attached? %>
              <%= cl_image_tag @dive_site.photo.key, height: 100 %>
            <% else %>
              <img src="<%= @dive_site.image %>" height="100">
            <% end %>
          </div>
        </div>
      </div>

      <div class="col-6">
        <div style="width: 100%; height: 550px;"
        data-controller="map"
        data-map-markers-value="<%= @markers.to_json %>"
        data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"></div>
      </div>
    </div>





  </div>
</div>

<div class="container py-5 my-5">
  <div class="row">
    <div class="col-6">
      <h2 class="fw-bold pb-5">Description of the site</h2>
      <p><%= @dive_site.description %>
    </div>
    <div class="col-6">
      <h4 class="fw-bold pb-5">Features other divers have seen at this site:</h4>
    </div>




  </div>
</div>

<div class="container">
      <h2 class="fw-bold pb-5">Feedback of the site (<%= pluralize @dive_site.reviews.count, "review" %>)</h2>
  <div class="row">
    <% @dive_site.reviews.each do |review|  %>
      <div class="col">
        <div class="review-card">
          <% if review.user.photo.present? %>
            <%= cl_image_tag review.user.photo.key, class: "review-avatar" %><br>
          <% else %>
            <%= image_tag "diver.png", class: "review-avatar"%><br>
          <% end %>
          <% count = 0 %>
            <% 5.times do %>
              <% if review.rating > count %>
                <i class="fa-solid fa-star star-color"></i>
              <% else %>
                <i class="fa-regular fa-star star-color"></i>
              <% end %>
                <% count += 1 %>
            <% end %>
          <h3><%= link_to "#{review.user.first_name} #{review.user.last_name}", profile_path(review.user.id) %></h3>
          <h6>Highlights:</h6> <p><%= review.highlight %></p>
          <h6>Tips:</h6> <p><%= review.tips %></p>
          <% if review.user.id == current_user.id %>
            <%= link_to "Edit your review", edit_review_path(review) %>
            <%= link_to "Delete this review", review_path(review), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>


</div>
